{"pageProps":{"noteKey":["csharp","chsarp-mongo-driver","cs-mongo-bulk"],"note":{"title":"C# Mongo Bulk Operations","date":"2022-06-21","content":"\n<h2>Bulk Upsert</h2>\n<p>To create bulk upsert with C# <code>MongoDb</code> driver use following snippet:</p>\n<pre><code class=\"hljs language-csharp\">IList&#x3C;TMongoDto> mongoDtos = GetMongoDtosList(); <span class=\"hljs-comment\">// List here to avoid multiple enumeration, but it is not crucial</span>\n<span class=\"hljs-keyword\">var</span> bulk = <span class=\"hljs-keyword\">new</span> List&#x3C;WriteModel&#x3C;TMongoDto>>(mongoDtos.Count);\n\n<span class=\"hljs-keyword\">foreach</span> (<span class=\"hljs-keyword\">var</span> pretendingDto <span class=\"hljs-keyword\">in</span> mongoDtos)\n{\n    <span class=\"hljs-keyword\">var</span> filter = Builders&#x3C;TransientElementDepartureDateMongoDto>.Filter.Where((actual) =>\n        actual.Key == pretendingDto.Key <span class=\"hljs-comment\">// or any other suitable bool expression allowing to identify item, which has to be overwritten</span>\n    );\n\n    <span class=\"hljs-keyword\">var</span> upsertModel = <span class=\"hljs-keyword\">new</span> ReplaceOneModel&#x3C;TransientElementDepartureDateMongoDto>(filter, pretendingDto)\n    { \n        IsUpsert = <span class=\"hljs-literal\">true</span> \n    };\n\n    bulk.Add(upsertModel);\n}\n\n<span class=\"hljs-keyword\">await</span> Collection.BulkWriteAsync(bulk, <span class=\"hljs-literal\">null</span>, cancellationToken);\n</code></pre>\n"}},"__N_SSG":true}