{"pageProps":{"noteKey":["javascript","npm","publish-package"],"note":{"title":"Publishing NPM Package With Typescript","date":"2022-06-30","content":"\n<h2>Init Typescript Project</h2>\n<p>Create a new project folder and place inside:</p>\n<p><code>package.json</code> with following content:</p>\n<pre><code class=\"hljs language-json\"><span class=\"hljs-punctuation\">{</span>\n  <span class=\"hljs-attr\">\"name\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"package-name\"</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">\"version\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"0.0.1\"</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">\"description\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"package description\"</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">\"main\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"build/index.js\"</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-comment\">// path to main executable script</span>\n  <span class=\"hljs-attr\">\"types\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"build/index.d.ts\"</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-comment\">// path to main type declarations file</span>\n  <span class=\"hljs-attr\">\"scripts\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n    <span class=\"hljs-attr\">\"test\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"jest --coverage\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"test:watch\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"jest --coverage --watchAll\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"format\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"prettier --config .prettierrc 'src/**/*.ts' --write\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"lint\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"eslint . --ext .ts\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"view:coverage\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"serve coverage/lcov-report\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"build\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"tsc\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"dev\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"tsc --watch\"</span>\n  <span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">\"devDependencies\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n    <span class=\"hljs-attr\">\"@types/jest\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"^27.4.1\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"@types/node\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"^17.0.23\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"@typescript-eslint/eslint-plugin\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"^5.17.0\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"@typescript-eslint/parser\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"^5.17.0\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"eslint\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"^8.12.0\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"eslint-config-prettier\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"^8.5.0\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"eslint-plugin-prettier\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"^4.0.0\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"install\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"^0.13.0\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"jest\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"^27.5.1\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"npm\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"^8.5.5\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"prettier\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"^2.6.1\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"ts-jest\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"^27.1.4\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"typescript\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"^4.6.3\"</span>\n  <span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">\"repository\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n    <span class=\"hljs-attr\">\"type\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"git\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"url\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"git repo url\"</span>\n  <span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">\"author\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"author name\"</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">\"license\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"ISC\"</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">\"bugs\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n    <span class=\"hljs-attr\">\"url\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"issues url\"</span>\n  <span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">\"homepage\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"readme url\"</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">\"dependencies\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n  <span class=\"hljs-punctuation\">}</span>\n<span class=\"hljs-punctuation\">}</span>\n</code></pre>\n<p>\n  Here <code>name</code> - it is a name of package. With this name it will be created in npm registry.\n  <code>version</code> is a version of package. Package can not be exported with same version twice.\n  <code>main</code> and <code>types</code> define paths to main executable and types. We add <code>/build</code> section because as we have\n  a <code>typescript</code> project, our executables will be compiled and placed to specific folder. In our case\n  this specific folder will be <code>build</code>, which we will specify in <code>tsconfig.json</code> file next. Depending on\n  configuration you can choose any name you prefer.\n</p>\n<p><em>in this example we will pack all the project, but we can also create configuration, when only <code>build</code> content will be published</em></p>\n<p>\n  In <code>repository</code> section we can specify path to project's repository.\n  <code>homepage</code> defines path to project's main page. Often it is a path to the readme file on git.\n  <code>bugs</code> section defines path to the issues page of the project.\n</p>\n<p><code>tsconfig.json</code> with following content:</p>\n<pre><code class=\"hljs language-json\"><span class=\"hljs-punctuation\">{</span>\n    <span class=\"hljs-attr\">\"compilerOptions\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n        <span class=\"hljs-attr\">\"target\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"es2016\"</span><span class=\"hljs-punctuation\">,</span>\n        <span class=\"hljs-attr\">\"lib\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span>\n        <span class=\"hljs-string\">\"es6\"</span>\n        <span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n        <span class=\"hljs-attr\">\"module\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"commonjs\"</span><span class=\"hljs-punctuation\">,</span>\n        <span class=\"hljs-attr\">\"rootDir\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"\"</span><span class=\"hljs-punctuation\">,</span>\n        <span class=\"hljs-attr\">\"resolveJsonModule\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">true</span><span class=\"hljs-punctuation\">,</span>\n        <span class=\"hljs-attr\">\"allowJs\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">false</span><span class=\"hljs-punctuation\">,</span>\n        <span class=\"hljs-attr\">\"declaration\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">true</span><span class=\"hljs-punctuation\">,</span>\n        <span class=\"hljs-attr\">\"sourceMap\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">true</span><span class=\"hljs-punctuation\">,</span>\n        <span class=\"hljs-attr\">\"outDir\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"build\"</span><span class=\"hljs-punctuation\">,</span>\n        <span class=\"hljs-attr\">\"removeComments\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">true</span><span class=\"hljs-punctuation\">,</span>\n        <span class=\"hljs-attr\">\"noEmitOnError\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">true</span><span class=\"hljs-punctuation\">,</span>\n        <span class=\"hljs-attr\">\"esModuleInterop\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">true</span><span class=\"hljs-punctuation\">,</span>\n        <span class=\"hljs-attr\">\"forceConsistentCasingInFileNames\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">true</span><span class=\"hljs-punctuation\">,</span>\n        <span class=\"hljs-attr\">\"strict\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">true</span><span class=\"hljs-punctuation\">,</span>\n        <span class=\"hljs-attr\">\"noImplicitAny\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">true</span><span class=\"hljs-punctuation\">,</span>\n        <span class=\"hljs-attr\">\"noImplicitThis\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">true</span><span class=\"hljs-punctuation\">,</span>\n        <span class=\"hljs-attr\">\"alwaysStrict\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">true</span><span class=\"hljs-punctuation\">,</span>\n        <span class=\"hljs-attr\">\"skipLibCheck\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">true</span>\n    <span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"exclude\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span>\n        <span class=\"hljs-string\">\"node_modules\"</span><span class=\"hljs-punctuation\">,</span>\n        <span class=\"hljs-string\">\"**/*.js\"</span><span class=\"hljs-punctuation\">,</span>\n        <span class=\"hljs-string\">\"**/*.dev.ts\"</span><span class=\"hljs-punctuation\">,</span>\n        <span class=\"hljs-string\">\"build\"</span>\n    <span class=\"hljs-punctuation\">]</span>\n<span class=\"hljs-punctuation\">}</span>\n</code></pre>\n<p>For testing configure <code>jest</code>:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-comment\">/** <span class=\"hljs-doctag\">@type</span> {<span class=\"hljs-type\">import('ts-jest/dist/types').InitialOptionsTsJest</span>} */</span>\n<span class=\"hljs-variable language_\">module</span>.<span class=\"hljs-property\">exports</span> = {\n    <span class=\"hljs-attr\">preset</span>: <span class=\"hljs-string\">'ts-jest'</span>,\n    <span class=\"hljs-attr\">testEnvironment</span>: <span class=\"hljs-string\">'node'</span>,\n    <span class=\"hljs-attr\">moduleNameMapper</span>: {\n        <span class=\"hljs-string\">\"@exmpl/(.*)\"</span>: <span class=\"hljs-string\">\"&#x3C;rootDir>/src/$1\"</span>\n    },\n    <span class=\"hljs-string\">\"testRegex\"</span>: <span class=\"hljs-string\">\"((/__tests__/).*|(\\\\.|/)(test|spec))\\\\.(ts|js)$\"</span>,\n    <span class=\"hljs-string\">\"coverageDirectory\"</span>: <span class=\"hljs-string\">\"coverage\"</span>,\n    <span class=\"hljs-string\">\"collectCoverageFrom\"</span>: [\n        <span class=\"hljs-string\">\"src/**/*.{ts}\"</span>,\n        <span class=\"hljs-string\">\"src/**/*.d.ts\"</span>\n    ]\n};\n</code></pre>\n<p>\n  Also we have defined <code>prettier</code> and <code>eslint</code> in our dev dependencies. For them we need to create\n  <code>.prettierrc</code>, <code>.eslintrc</code> and <code>.eslintignore</code> files in the root of projects with proper configuration,\n  you prefer.\n</p>\n<p>As a starter for example let's use:</p>\n<p>For <code>.prettierrc</code>:</p>\n<pre><code class=\"hljs language-json\"><span class=\"hljs-punctuation\">{</span>\n    <span class=\"hljs-attr\">\"semi\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">true</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"trailingComma\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"none\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"singleQuote\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">true</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"printWidth\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-number\">80</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"tabWidth\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-number\">2</span>\n<span class=\"hljs-punctuation\">}</span>\n</code></pre>\n<p>For <code>.eslintrc</code>:</p>\n<pre><code class=\"hljs language-json\"><span class=\"hljs-punctuation\">{</span>\n    <span class=\"hljs-attr\">\"root\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-keyword\">true</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"parser\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"@typescript-eslint/parser\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"plugins\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span>\n        <span class=\"hljs-string\">\"@typescript-eslint\"</span>\n    <span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"extends\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span>\n        <span class=\"hljs-string\">\"eslint:recommended\"</span><span class=\"hljs-punctuation\">,</span>\n        <span class=\"hljs-string\">\"plugin:@typescript-eslint/eslint-recommended\"</span><span class=\"hljs-punctuation\">,</span>\n        <span class=\"hljs-string\">\"plugin:@typescript-eslint/recommended\"</span><span class=\"hljs-punctuation\">,</span>\n        <span class=\"hljs-string\">\"prettier\"</span>\n    <span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"rules\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n    <span class=\"hljs-punctuation\">}</span>\n<span class=\"hljs-punctuation\">}</span>\n</code></pre>\n<p>For <code>.eslinignore</code>:</p>\n<pre><code class=\"hljs language-txt\">node_modules/\nbuild/\n**/*.js\n</code></pre>\n<p>Create folders <code>src</code> and <code>tests</code> in root project folder.</p>\n<p>Now we can create our business code in <code>src</code> folders and tests in <code>tests</code> folder.</p>\n<h2>Publish Package</h2>\n<p>\n  As our package is ready, we can publish it. But before that we have to login into <code>npm</code>.\n  To do that run:\n</p>\n<pre><code class=\"hljs language-bash\">npm adduser\n</code></pre>\n<p>This command will ask for username, password and <code>OTP</code>.</p>\n<p>Once that is done run:</p>\n<pre><code class=\"hljs language-bash\">npm publish\n</code></pre>\n<p>Now the package should be successfully published into npm registry.</p>\n<h2>Publish On Github NPM Registry</h2>\n<p>Create <code>Github</code> access token with following permissions:</p>\n<ul>\n  <li><code>repo</code></li>\n  <li><code>write:packages</code></li>\n  <li><code>read:packages</code></li>\n</ul>\n<p>Then authorize <code>npm</code> to access <code>Github</code> registry:</p>\n<pre><code class=\"hljs language-bash\">npm config <span class=\"hljs-built_in\">set</span> //npm.pkg.github.com/:_authToken &#x3C;generated-token>\n</code></pre>\n<p>\n  <code>Github</code> only allows to push packages within a context of user account, so field <code>name</code> in <code>package.json</code>\n  should be assembled as follows:\n</p>\n<pre><code class=\"hljs language-json\"><span class=\"hljs-attr\">\"name\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"@&#x3C;account-name>/&#x3C;package-name>\"</span>\n</code></pre>\n<p>Then to use our uploaded package from custom scope, we should specify source in <code>.npmrc</code> file:</p>\n<pre><code class=\"hljs language-txt\">@&#x3C;account-name>:registry=https://npm.pkg.github.com/\n</code></pre>\n<p>Now installing packages from <code>@&#x3C;account-name></code> they will be downloaded from customized source.</p>\n"}},"__N_SSG":true}