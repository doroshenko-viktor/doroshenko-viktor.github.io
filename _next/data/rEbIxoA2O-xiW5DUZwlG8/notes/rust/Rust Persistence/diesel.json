{"pageProps":{"noteKey":["rust","Rust Persistence","diesel"],"note":{"title":"Diesel - Rust ORM","date":"2022-12-31","content":"\n<h2></h2>\n<p><code>DATABASE_URL=&#x3C;database_url></code></p>\n<h2>Diesel CLI</h2>\n<h3>Install Diesel CLI</h3>\n<p>To install <code>diesel cli</code> run:</p>\n<pre><code class=\"hljs language-bash\">cargo install diesel_cli --no-default-features --features &#x3C;feature>\n</code></pre>\n<p>\n  Where <code>&#x3C;feature></code> is a required database lib, e.g. <code>postgres</code> or <code>sqlite</code>. It is possible to install <code>diesel</code> with several\n  features with <code>--features postgres,sqlite</code>\n</p>\n<p>\n  To install <code>diesel cli</code> with <code>postgres</code> feature you need to have <code>libpq</code> installed on your machine.\n  On macos it may be installed with <code>brew install libpq</code>.\n</p>\n<p>Then you need to inform <code>cargo</code> about <code>libpq</code> location. It may be done either by providing environment variable:</p>\n<pre><code class=\"hljs language-bash\">RUSTFLAGS=<span class=\"hljs-string\">'-L /opt/homebrew/opt/libpq/lib'</span>\n</code></pre>\n<p>Or with <code>cargo</code> config file, located in <code>~/.cargo/config.toml</code>. Add following to this file:</p>\n<pre><code class=\"hljs language-txt\">[target.aarch64-apple-darwin]\nrustflags = '-L /opt/homebrew/opt/libpq/lib -L /opt/homebrew/lib'\n</code></pre>\n<h3>Commands</h3>\n<p>Initialize <code>diesel</code> project:</p>\n<pre><code class=\"hljs language-bash\">diesel setup\n</code></pre>\n<p>This command will create migrations folder and generate <code>diesel.toml</code> file.</p>\n<p>To create new migration execute:</p>\n<pre><code class=\"hljs language-bash\">diesel migration generate &#x3C;migration_name>\n</code></pre>\n<p>\n  After this in migration folder will be created new migration with name, consisting of current timestamp and <code>migration_name</code>.\n  In the folder of created migration there will be two files - <code>up.sql</code>, which is used to run code of migration and <code>down.sql</code>,\n  which is used to revert this migration.\n</p>\n<p>To execute migration code in the database run:</p>\n<pre><code class=\"hljs language-bash\">diesel migration run\n</code></pre>\n<p>To revert executed migration:</p>\n<pre><code class=\"hljs language-bash\">diesel migration redo\n</code></pre>\n"}},"__N_SSG":true}