<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>JavaScript Web Workers</title><link rel="icon" href="/images/favicon.ico"/><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/b65b5b41f2379875.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b65b5b41f2379875.css" data-n-g=""/><link rel="preload" href="/_next/static/css/0d9654b911e08999.css" as="style"/><link rel="stylesheet" href="/_next/static/css/0d9654b911e08999.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-69bfa6990bb9e155.js" defer=""></script><script src="/_next/static/chunks/framework-fc97f3f1282ce3ed.js" defer=""></script><script src="/_next/static/chunks/main-f4ae3437c92c1efc.js" defer=""></script><script src="/_next/static/chunks/pages/_app-85d7488a393e293e.js" defer=""></script><script src="/_next/static/chunks/211-ca3cd870e26e881a.js" defer=""></script><script src="/_next/static/chunks/pages/notes/%5B...noteKey%5D-bc6552c3ae1e3718.js" defer=""></script><script src="/_next/static/rEbIxoA2O-xiW5DUZwlG8/_buildManifest.js" defer=""></script><script src="/_next/static/rEbIxoA2O-xiW5DUZwlG8/_ssgManifest.js" defer=""></script><script src="/_next/static/rEbIxoA2O-xiW5DUZwlG8/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><section class="Layout_centeredSection__nmU9U"><ul class="NavigationBar_navbar__CBMoV"><li class="NavigationBar_navitem__LKB5F"><a class="NavigationBar_navitemContent__jEyWq" href="/">Home</a><span class="NavigationBar_separator__qvEVD">|</span></li><li class="NavigationBar_navitem__LKB5F"><button class="NavigationBar_navitemContent__jEyWq">Back</button><span class="NavigationBar_separator__qvEVD">|</span></li></ul><h1 class="NoteFormattedContent_noteTitle__Oi9sD">JavaScript Web Workers</h1><article class="NoteFormattedContent_note__8cHeE">
<p>
  <code>Web worker</code> is a separate JS thread, working in parallel with the main thread and communicating with
  it using messaging system.
</p>
<p>
  In browser to create web worker, we need to have two separate JS files. For example <code>app.js</code> and
  <code>worker.js</code>. This is required, because these files will be executed in separate threads. And also
  worker js file will be required to create worker object.
</p>
<p>To to that, add following code to the <code>app.js</code> file:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">let</span> worker = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Worker</span>(<span class="hljs-string">'./worker.js'</span>);

worker.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'message'</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =></span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Worker said: <span class="hljs-subst">${event.data}</span>`</span>);
})

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Saying "Hi" to worker'</span>);
worker.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">'Hi, worker!'</span>);

<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =></span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Requesting worker\'s status'</span>);
    worker.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">'Hey, worker, how\'s it going?'</span>);

    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =></span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Signalling about end of workday'</span>);
        worker.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">'Work day is over'</span>);
    }, <span class="hljs-number">100</span>);
}, <span class="hljs-number">100</span>);
</code></pre>
<p>and to the <code>worker.js</code>:</p>
<pre><code class="hljs language-js"><span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'message'</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =></span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isWorkOver</span>(event.<span class="hljs-property">data</span>)) {
        <span class="hljs-title function_">postMessage</span>(<span class="hljs-string">'Bie, until tomorrow!'</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">close</span>();
    }

    <span class="hljs-keyword">var</span> response = <span class="hljs-title function_">getResponse</span>(event.<span class="hljs-property">data</span>);
    <span class="hljs-title function_">postMessage</span>(response);
});

<span class="hljs-keyword">function</span> <span class="hljs-title function_">isWorkOver</span>(<span class="hljs-params">message</span>) {
    <span class="hljs-keyword">return</span> message === <span class="hljs-string">'Work day is over'</span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getResponse</span>(<span class="hljs-params">message</span>) {
    <span class="hljs-keyword">if</span> (message === <span class="hljs-string">'Hi, worker!'</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">'Hi, main!'</span>;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">'I\'m working...'</span>;
    }
}
</code></pre>
<p>Here main thread sends to worker different messages and has an event listener for worker's messages.</p>
<p>
  Important to note, that workers have separate call stack and heap, so passing messages send a copy
  of data. It is not possible to share data by reference.
</p>
<p>
  To test it locally better to use some server, because it is not possible to run workers from local
  file system by security concerns. At least in Chrome.
</p>
<h2>References</h2>
<ul>
  <li><a href="https://html.spec.whatwg.org/multipage/workers.html">https://html.spec.whatwg.org/multipage/workers.html</a></li>
</ul>
</article></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"noteKey":["javascript","web-workers"],"note":{"title":"JavaScript Web Workers","date":"2022-06-03","content":"\n\u003cp\u003e\n  \u003ccode\u003eWeb worker\u003c/code\u003e is a separate JS thread, working in parallel with the main thread and communicating with\n  it using messaging system.\n\u003c/p\u003e\n\u003cp\u003e\n  In browser to create web worker, we need to have two separate JS files. For example \u003ccode\u003eapp.js\u003c/code\u003e and\n  \u003ccode\u003eworker.js\u003c/code\u003e. This is required, because these files will be executed in separate threads. And also\n  worker js file will be required to create worker object.\n\u003c/p\u003e\n\u003cp\u003eTo to that, add following code to the \u003ccode\u003eapp.js\u003c/code\u003e file:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e worker = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eWorker\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'./worker.js'\u003c/span\u003e);\n\nworker.\u003cspan class=\"hljs-title function_\"\u003eaddEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'message'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eevent\u003c/span\u003e) =\u003e\u003c/span\u003e {\n    \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e`Worker said: \u003cspan class=\"hljs-subst\"\u003e${event.data}\u003c/span\u003e`\u003c/span\u003e);\n})\n\n\u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'Saying \"Hi\" to worker'\u003c/span\u003e);\nworker.\u003cspan class=\"hljs-title function_\"\u003epostMessage\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'Hi, worker!'\u003c/span\u003e);\n\n\u003cspan class=\"hljs-built_in\"\u003esetTimeout\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u003e\u003c/span\u003e {\n    \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'Requesting worker\\'s status'\u003c/span\u003e);\n    worker.\u003cspan class=\"hljs-title function_\"\u003epostMessage\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'Hey, worker, how\\'s it going?'\u003c/span\u003e);\n\n    \u003cspan class=\"hljs-built_in\"\u003esetTimeout\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u003e\u003c/span\u003e {\n        \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'Signalling about end of workday'\u003c/span\u003e);\n        worker.\u003cspan class=\"hljs-title function_\"\u003epostMessage\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'Work day is over'\u003c/span\u003e);\n    }, \u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e);\n}, \u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eand to the \u003ccode\u003eworker.js\u003c/code\u003e:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-title function_\"\u003eaddEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'message'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eevent\u003c/span\u003e) =\u003e\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-title function_\"\u003eisWorkOver\u003c/span\u003e(event.\u003cspan class=\"hljs-property\"\u003edata\u003c/span\u003e)) {\n        \u003cspan class=\"hljs-title function_\"\u003epostMessage\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'Bie, until tomorrow!'\u003c/span\u003e);\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eclose\u003c/span\u003e();\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e response = \u003cspan class=\"hljs-title function_\"\u003egetResponse\u003c/span\u003e(event.\u003cspan class=\"hljs-property\"\u003edata\u003c/span\u003e);\n    \u003cspan class=\"hljs-title function_\"\u003epostMessage\u003c/span\u003e(response);\n});\n\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eisWorkOver\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003emessage\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e message === \u003cspan class=\"hljs-string\"\u003e'Work day is over'\u003c/span\u003e;\n}\n\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003egetResponse\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003emessage\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (message === \u003cspan class=\"hljs-string\"\u003e'Hi, worker!'\u003c/span\u003e) {\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'Hi, main!'\u003c/span\u003e;\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'I\\'m working...'\u003c/span\u003e;\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eHere main thread sends to worker different messages and has an event listener for worker's messages.\u003c/p\u003e\n\u003cp\u003e\n  Important to note, that workers have separate call stack and heap, so passing messages send a copy\n  of data. It is not possible to share data by reference.\n\u003c/p\u003e\n\u003cp\u003e\n  To test it locally better to use some server, because it is not possible to run workers from local\n  file system by security concerns. At least in Chrome.\n\u003c/p\u003e\n\u003ch2\u003eReferences\u003c/h2\u003e\n\u003cul\u003e\n  \u003cli\u003e\u003ca href=\"https://html.spec.whatwg.org/multipage/workers.html\"\u003ehttps://html.spec.whatwg.org/multipage/workers.html\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n"}},"__N_SSG":true},"page":"/notes/[...noteKey]","query":{"noteKey":["javascript","web-workers"]},"buildId":"rEbIxoA2O-xiW5DUZwlG8","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>