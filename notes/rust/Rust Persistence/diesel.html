<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Diesel - Rust ORM</title><link rel="icon" href="/images/favicon.ico"/><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/b65b5b41f2379875.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b65b5b41f2379875.css" data-n-g=""/><link rel="preload" href="/_next/static/css/0d9654b911e08999.css" as="style"/><link rel="stylesheet" href="/_next/static/css/0d9654b911e08999.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-69bfa6990bb9e155.js" defer=""></script><script src="/_next/static/chunks/framework-fc97f3f1282ce3ed.js" defer=""></script><script src="/_next/static/chunks/main-f4ae3437c92c1efc.js" defer=""></script><script src="/_next/static/chunks/pages/_app-85d7488a393e293e.js" defer=""></script><script src="/_next/static/chunks/211-ca3cd870e26e881a.js" defer=""></script><script src="/_next/static/chunks/pages/notes/%5B...noteKey%5D-bc6552c3ae1e3718.js" defer=""></script><script src="/_next/static/IjqNhIRqaAJaH2DY5dkbz/_buildManifest.js" defer=""></script><script src="/_next/static/IjqNhIRqaAJaH2DY5dkbz/_ssgManifest.js" defer=""></script><script src="/_next/static/IjqNhIRqaAJaH2DY5dkbz/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><section class="Layout_centeredSection__nmU9U"><ul class="NavigationBar_navbar__CBMoV"><li class="NavigationBar_navitem__LKB5F"><a class="NavigationBar_navitemContent__jEyWq" href="/">Home</a><span class="NavigationBar_separator__qvEVD">|</span></li><li class="NavigationBar_navitem__LKB5F"><button class="NavigationBar_navitemContent__jEyWq">Back</button><span class="NavigationBar_separator__qvEVD">|</span></li></ul><h1 class="NoteFormattedContent_noteTitle__Oi9sD">Diesel - Rust ORM</h1><article class="NoteFormattedContent_note__8cHeE">
<h2></h2>
<p><code>DATABASE_URL=&#x3C;database_url></code></p>
<h2>Diesel CLI</h2>
<h3>Install Diesel CLI</h3>
<p>To install <code>diesel cli</code> run:</p>
<pre><code class="hljs language-bash">cargo install diesel_cli --no-default-features --features &#x3C;feature>
</code></pre>
<p>
  Where <code>&#x3C;feature></code> is a required database lib, e.g. <code>postgres</code> or <code>sqlite</code>. It is possible to install <code>diesel</code> with several
  features with <code>--features postgres,sqlite</code>
</p>
<p>
  To install <code>diesel cli</code> with <code>postgres</code> feature you need to have <code>libpq</code> installed on your machine.
  On macos it may be installed with <code>brew install libpq</code>.
</p>
<p>Then you need to inform <code>cargo</code> about <code>libpq</code> location. It may be done either by providing environment variable:</p>
<pre><code class="hljs language-bash">RUSTFLAGS=<span class="hljs-string">'-L /opt/homebrew/opt/libpq/lib'</span>
</code></pre>
<p>Or with <code>cargo</code> config file, located in <code>~/.cargo/config.toml</code>. Add following to this file:</p>
<pre><code class="hljs language-txt">[target.aarch64-apple-darwin]
rustflags = '-L /opt/homebrew/opt/libpq/lib -L /opt/homebrew/lib'
</code></pre>
<h3>Commands</h3>
<p>Initialize <code>diesel</code> project:</p>
<pre><code class="hljs language-bash">diesel setup
</code></pre>
<p>This command will create migrations folder and generate <code>diesel.toml</code> file.</p>
<p>To create new migration execute:</p>
<pre><code class="hljs language-bash">diesel migration generate &#x3C;migration_name>
</code></pre>
<p>
  After this in migration folder will be created new migration with name, consisting of current timestamp and <code>migration_name</code>.
  In the folder of created migration there will be two files - <code>up.sql</code>, which is used to run code of migration and <code>down.sql</code>,
  which is used to revert this migration.
</p>
<p>To execute migration code in the database run:</p>
<pre><code class="hljs language-bash">diesel migration run
</code></pre>
<p>To revert executed migration:</p>
<pre><code class="hljs language-bash">diesel migration redo
</code></pre>
</article></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"noteKey":["rust","Rust Persistence","diesel"],"note":{"title":"Diesel - Rust ORM","date":"2022-12-31","content":"\n\u003ch2\u003e\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003eDATABASE_URL=\u0026#x3C;database_url\u003e\u003c/code\u003e\u003c/p\u003e\n\u003ch2\u003eDiesel CLI\u003c/h2\u003e\n\u003ch3\u003eInstall Diesel CLI\u003c/h3\u003e\n\u003cp\u003eTo install \u003ccode\u003ediesel cli\u003c/code\u003e run:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ecargo install diesel_cli --no-default-features --features \u0026#x3C;feature\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\n  Where \u003ccode\u003e\u0026#x3C;feature\u003e\u003c/code\u003e is a required database lib, e.g. \u003ccode\u003epostgres\u003c/code\u003e or \u003ccode\u003esqlite\u003c/code\u003e. It is possible to install \u003ccode\u003ediesel\u003c/code\u003e with several\n  features with \u003ccode\u003e--features postgres,sqlite\u003c/code\u003e\n\u003c/p\u003e\n\u003cp\u003e\n  To install \u003ccode\u003ediesel cli\u003c/code\u003e with \u003ccode\u003epostgres\u003c/code\u003e feature you need to have \u003ccode\u003elibpq\u003c/code\u003e installed on your machine.\n  On macos it may be installed with \u003ccode\u003ebrew install libpq\u003c/code\u003e.\n\u003c/p\u003e\n\u003cp\u003eThen you need to inform \u003ccode\u003ecargo\u003c/code\u003e about \u003ccode\u003elibpq\u003c/code\u003e location. It may be done either by providing environment variable:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eRUSTFLAGS=\u003cspan class=\"hljs-string\"\u003e'-L /opt/homebrew/opt/libpq/lib'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eOr with \u003ccode\u003ecargo\u003c/code\u003e config file, located in \u003ccode\u003e~/.cargo/config.toml\u003c/code\u003e. Add following to this file:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-txt\"\u003e[target.aarch64-apple-darwin]\nrustflags = '-L /opt/homebrew/opt/libpq/lib -L /opt/homebrew/lib'\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eCommands\u003c/h3\u003e\n\u003cp\u003eInitialize \u003ccode\u003ediesel\u003c/code\u003e project:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ediesel setup\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis command will create migrations folder and generate \u003ccode\u003ediesel.toml\u003c/code\u003e file.\u003c/p\u003e\n\u003cp\u003eTo create new migration execute:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ediesel migration generate \u0026#x3C;migration_name\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\n  After this in migration folder will be created new migration with name, consisting of current timestamp and \u003ccode\u003emigration_name\u003c/code\u003e.\n  In the folder of created migration there will be two files - \u003ccode\u003eup.sql\u003c/code\u003e, which is used to run code of migration and \u003ccode\u003edown.sql\u003c/code\u003e,\n  which is used to revert this migration.\n\u003c/p\u003e\n\u003cp\u003eTo execute migration code in the database run:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ediesel migration run\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eTo revert executed migration:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003ediesel migration redo\n\u003c/code\u003e\u003c/pre\u003e\n"}},"__N_SSG":true},"page":"/notes/[...noteKey]","query":{"noteKey":["rust","Rust Persistence","diesel"]},"buildId":"IjqNhIRqaAJaH2DY5dkbz","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>