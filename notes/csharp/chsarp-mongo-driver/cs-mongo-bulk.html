<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>C# Mongo Bulk Operations</title><link rel="icon" href="/images/favicon.ico"/><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/b65b5b41f2379875.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b65b5b41f2379875.css" data-n-g=""/><link rel="preload" href="/_next/static/css/0d9654b911e08999.css" as="style"/><link rel="stylesheet" href="/_next/static/css/0d9654b911e08999.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-69bfa6990bb9e155.js" defer=""></script><script src="/_next/static/chunks/framework-fc97f3f1282ce3ed.js" defer=""></script><script src="/_next/static/chunks/main-f4ae3437c92c1efc.js" defer=""></script><script src="/_next/static/chunks/pages/_app-85d7488a393e293e.js" defer=""></script><script src="/_next/static/chunks/211-ca3cd870e26e881a.js" defer=""></script><script src="/_next/static/chunks/pages/notes/%5B...noteKey%5D-bc6552c3ae1e3718.js" defer=""></script><script src="/_next/static/6V8_yxN3djhrhbRemYkax/_buildManifest.js" defer=""></script><script src="/_next/static/6V8_yxN3djhrhbRemYkax/_ssgManifest.js" defer=""></script><script src="/_next/static/6V8_yxN3djhrhbRemYkax/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><section class="Layout_centeredSection__nmU9U"><ul class="NavigationBar_navbar__CBMoV"><li class="NavigationBar_navitem__LKB5F"><a class="NavigationBar_navitemContent__jEyWq" href="/">Home</a><span class="NavigationBar_separator__qvEVD">|</span></li><li class="NavigationBar_navitem__LKB5F"><button class="NavigationBar_navitemContent__jEyWq">Back</button><span class="NavigationBar_separator__qvEVD">|</span></li></ul><h1 class="NoteFormattedContent_noteTitle__Oi9sD">C# Mongo Bulk Operations</h1><article class="NoteFormattedContent_note__8cHeE">
<h2>Bulk Upsert</h2>
<p>To create bulk upsert with C# <code>MongoDb</code> driver use following snippet:</p>
<pre><code class="hljs language-csharp">IList&#x3C;TMongoDto> mongoDtos = GetMongoDtosList(); <span class="hljs-comment">// List here to avoid multiple enumeration, but it is not crucial</span>
<span class="hljs-keyword">var</span> bulk = <span class="hljs-keyword">new</span> List&#x3C;WriteModel&#x3C;TMongoDto>>(mongoDtos.Count);

<span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> pretendingDto <span class="hljs-keyword">in</span> mongoDtos)
{
    <span class="hljs-keyword">var</span> filter = Builders&#x3C;TransientElementDepartureDateMongoDto>.Filter.Where((actual) =>
        actual.Key == pretendingDto.Key <span class="hljs-comment">// or any other suitable bool expression allowing to identify item, which has to be overwritten</span>
    );

    <span class="hljs-keyword">var</span> upsertModel = <span class="hljs-keyword">new</span> ReplaceOneModel&#x3C;TransientElementDepartureDateMongoDto>(filter, pretendingDto)
    { 
        IsUpsert = <span class="hljs-literal">true</span> 
    };

    bulk.Add(upsertModel);
}

<span class="hljs-keyword">await</span> Collection.BulkWriteAsync(bulk, <span class="hljs-literal">null</span>, cancellationToken);
</code></pre>
</article></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"noteKey":["csharp","chsarp-mongo-driver","cs-mongo-bulk"],"note":{"title":"C# Mongo Bulk Operations","date":"2022-06-21","content":"\n\u003ch2\u003eBulk Upsert\u003c/h2\u003e\n\u003cp\u003eTo create bulk upsert with C# \u003ccode\u003eMongoDb\u003c/code\u003e driver use following snippet:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-csharp\"\u003eIList\u0026#x3C;TMongoDto\u003e mongoDtos = GetMongoDtosList(); \u003cspan class=\"hljs-comment\"\u003e// List here to avoid multiple enumeration, but it is not crucial\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e bulk = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e List\u0026#x3C;WriteModel\u0026#x3C;TMongoDto\u003e\u003e(mongoDtos.Count);\n\n\u003cspan class=\"hljs-keyword\"\u003eforeach\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e pretendingDto \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e mongoDtos)\n{\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e filter = Builders\u0026#x3C;TransientElementDepartureDateMongoDto\u003e.Filter.Where((actual) =\u003e\n        actual.Key == pretendingDto.Key \u003cspan class=\"hljs-comment\"\u003e// or any other suitable bool expression allowing to identify item, which has to be overwritten\u003c/span\u003e\n    );\n\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e upsertModel = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e ReplaceOneModel\u0026#x3C;TransientElementDepartureDateMongoDto\u003e(filter, pretendingDto)\n    { \n        IsUpsert = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e \n    };\n\n    bulk.Add(upsertModel);\n}\n\n\u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e Collection.BulkWriteAsync(bulk, \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e, cancellationToken);\n\u003c/code\u003e\u003c/pre\u003e\n"}},"__N_SSG":true},"page":"/notes/[...noteKey]","query":{"noteKey":["csharp","chsarp-mongo-driver","cs-mongo-bulk"]},"buildId":"6V8_yxN3djhrhbRemYkax","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>