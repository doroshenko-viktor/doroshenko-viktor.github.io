<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>AutoFixture In C#</title><link rel="icon" href="/images/favicon.ico"/><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/b65b5b41f2379875.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b65b5b41f2379875.css" data-n-g=""/><link rel="preload" href="/_next/static/css/0d9654b911e08999.css" as="style"/><link rel="stylesheet" href="/_next/static/css/0d9654b911e08999.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-69bfa6990bb9e155.js" defer=""></script><script src="/_next/static/chunks/framework-fc97f3f1282ce3ed.js" defer=""></script><script src="/_next/static/chunks/main-f4ae3437c92c1efc.js" defer=""></script><script src="/_next/static/chunks/pages/_app-85d7488a393e293e.js" defer=""></script><script src="/_next/static/chunks/211-ca3cd870e26e881a.js" defer=""></script><script src="/_next/static/chunks/pages/notes/%5B...noteKey%5D-bc6552c3ae1e3718.js" defer=""></script><script src="/_next/static/6ijx-V4F20HyUkW-8GqL_/_buildManifest.js" defer=""></script><script src="/_next/static/6ijx-V4F20HyUkW-8GqL_/_ssgManifest.js" defer=""></script><script src="/_next/static/6ijx-V4F20HyUkW-8GqL_/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><section class="Layout_centeredSection__nmU9U"><ul class="NavigationBar_navbar__CBMoV"><li class="NavigationBar_navitem__LKB5F"><a class="NavigationBar_navitemContent__jEyWq" href="/">Home</a><span class="NavigationBar_separator__qvEVD">|</span></li><li class="NavigationBar_navitem__LKB5F"><button class="NavigationBar_navitemContent__jEyWq">Back</button><span class="NavigationBar_separator__qvEVD">|</span></li></ul><h1 class="NoteFormattedContent_noteTitle__Oi9sD">AutoFixture In C#</h1><article class="NoteFormattedContent_note__8cHeE">
<h2>Data Customization</h2>
<p>We have a simple model for test:</p>
<pre><code class="hljs language-csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-title">TripDto</span>(<span class="hljs-params">Guid Id, IEnumerable&#x3C;CityDto> City, <span class="hljs-built_in">string</span> Price, <span class="hljs-built_in">int</span> Days</span>)</span> { }
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-title">CityDto</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> Name, <span class="hljs-built_in">int</span> Size</span>)</span>;
</code></pre>
<p>Now let's introduce some constraints.</p>
<p>
  We want to have trips with amount of cities between <code>1</code> and <code>5</code>, prices between <code>"5000.5"</code> and <code>"9000.5"</code>,
  duration between <code>3</code> and <code>6</code> days.
</p>
<p><code>City.Name</code> must consist of only three capital letters</p>
<p>And say, we would have a <code>Price</code> as a string to be able to mitigate precision problems on serialization.</p>
<p>
  To create customized objects with <code>Autofixture</code> we need to create an class, which implements
  <code>ISpecimenBuilder</code> interface. This class will be executed every time auto-fixture will
  need to create new instance of <code>Entity</code>.
</p>
<pre><code class="hljs language-csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">EntityCustomization</span> : <span class="hljs-title">ISpecimenBuilder</span>
{
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">readonly</span> Random Rand;

    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-title">AbstractCustomization</span>(<span class="hljs-params">Random rand</span>)</span>
    {
        Rand = rand;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">object</span> <span class="hljs-title">Create</span>(<span class="hljs-params"><span class="hljs-built_in">object</span> request, ISpecimenContext context</span>)</span>
    {
        <span class="hljs-keyword">if</span> (request <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> Type type || type != <span class="hljs-keyword">typeof</span>(Entity))
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> NoSpecimen(); <span class="hljs-comment">// if a request, sent to our customization is not of type</span>
            <span class="hljs-comment">// we need to create, return signal, that we don't need to customize on it</span>

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Entity(); <span class="hljs-comment">// if current request is of type Entity, we can return customized instance of it</span>
    }
}
</code></pre>
<p>
  Partially this request type check will be on each custom <code>SpecimenBuilder</code>. To make some
  generalization, let's create a base abstract class, which will accumulate some common behavior
  and add additional randomization logic:
</p>
<pre><code class="hljs language-csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AbstractCustomization</span>&#x3C;<span class="hljs-title">T</span>> : <span class="hljs-title">ISpecimenBuilder</span> <span class="hljs-keyword">where</span> <span class="hljs-title">T</span> : <span class="hljs-title">notnull</span>
{
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">readonly</span> Random Rand;

    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-title">AbstractCustomization</span>(<span class="hljs-params">Random rand</span>)</span>
    {
        Rand = rand;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">object</span> <span class="hljs-title">Create</span>(<span class="hljs-params"><span class="hljs-built_in">object</span> request, ISpecimenContext context</span>)</span>
    {
        <span class="hljs-keyword">if</span> (request <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> Type type || type != <span class="hljs-keyword">typeof</span>(T))
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> NoSpecimen();

        <span class="hljs-keyword">return</span> Create(context);
    }

    <span class="hljs-comment">// this method will be executed only in case, when request is required type</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> T <span class="hljs-title">Create</span>(<span class="hljs-params">ISpecimenContext context</span>)</span>;

    <span class="hljs-comment">// returns string with numeric content</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetRandomNumberString</span>(<span class="hljs-params"><span class="hljs-built_in">double</span> <span class="hljs-keyword">from</span>, <span class="hljs-built_in">double</span> to</span>)</span> => Convert.ToString(
        Rand.NextInt64((<span class="hljs-built_in">long</span>)<span class="hljs-keyword">from</span>, (<span class="hljs-built_in">long</span>)(to - <span class="hljs-number">1</span>)) + Rand.NextDouble());

    <span class="hljs-comment">// get ASCII char by it's index</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-built_in">char</span> <span class="hljs-title">GetRandomASCIIChar</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> fromIndex, <span class="hljs-built_in">int</span> toIndex</span>)</span> => (<span class="hljs-built_in">char</span>)Rand.Next(fromIndex, toIndex);

    <span class="hljs-comment">// get random int in given range</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-built_in">int</span> <span class="hljs-title">GetInt</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> <span class="hljs-keyword">from</span>, <span class="hljs-built_in">int</span> to</span>)</span> => Rand.Next(<span class="hljs-keyword">from</span>, to);

    <span class="hljs-comment">// get string of given length from characters between specified indexes</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GenerateString</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> asciiIndexFrom, <span class="hljs-built_in">int</span> asciiIndexTo, <span class="hljs-built_in">int</span> length</span>)</span> => Enumerable
        .Repeat(() => GetRandomASCIIChar(asciiIndexFrom, asciiIndexTo), length)
        .Aggregate(<span class="hljs-keyword">new</span> StringBuilder(), (acc, getChar) =>
        {
            acc.Append(getChar());
            <span class="hljs-keyword">return</span> acc;
        })
        .ToString();
}
</code></pre>
<p>Now create a concrete implementations for two our DTOs:</p>
<pre><code class="hljs language-csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">TripCustomizations</span> : <span class="hljs-title">AbstractCustomization</span>&#x3C;<span class="hljs-title">TripDto</span>>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">TripCustomizations</span>(<span class="hljs-params">Random rand</span>) : <span class="hljs-title">base</span>(<span class="hljs-params">rand</span>)</span> { }

    <span class="hljs-comment">// generate TripDto object which satisfies required boundaries:</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> TripDto <span class="hljs-title">Create</span>(<span class="hljs-params">ISpecimenContext context</span>)</span> => <span class="hljs-keyword">new</span>(
        Id: Guid.NewGuid(),
        <span class="hljs-comment">// create collection of cities with length between 1 and 5</span>
        Cities: context.CreateMany&#x3C;CityDto>(GetInt(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>)),
        <span class="hljs-comment">// using methods, defined in abstract class to generate some randomized values</span>
        Price: GetRandomNumberString(<span class="hljs-number">5000.5</span>, <span class="hljs-number">9000.5</span>),
        Days: GetInt(<span class="hljs-number">3</span>, <span class="hljs-number">6</span>)
    );
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CityCustomization</span> : <span class="hljs-title">AbstractCustomization</span>&#x3C;<span class="hljs-title">CityDto</span>>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> HashSet&#x3C;<span class="hljs-built_in">string</span>> _usedCityNames = <span class="hljs-keyword">new</span>();

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CityCustomization</span>(<span class="hljs-params">Random rand</span>) : <span class="hljs-title">base</span>(<span class="hljs-params">rand</span>)</span>
    {
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> CityDto <span class="hljs-title">Create</span>(<span class="hljs-params">ISpecimenContext context</span>)</span> => <span class="hljs-keyword">new</span>(
        <span class="hljs-comment">// on city name we have a constraint - it has to be unique and consist of 3 capital latin letters.</span>
        Name: GetUnique3CapitalCharCityName(),
        Size: GetInt(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>)
    );

    <span class="hljs-comment">// to create every time only unique names, we will use hash set, stored as object's private member</span>
    <span class="hljs-comment">// every time we will need to get new name we will check if it exists in this cash and generate new</span>
    <span class="hljs-comment">// until we won't have a unique one. having unique name we will add it to cash and then return.</span>
    <span class="hljs-comment">// there may be more efficient implementation, e.g. using tries, but it is enough for now =)</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetUnique3CapitalCharCityName</span>()</span>
    {
        <span class="hljs-keyword">var</span> cityName = GenerateName();
        <span class="hljs-keyword">while</span> (_usedCityNames.Contains(cityName))
        {
            cityName = GenerateName();
        }
        _usedCityNames.Add(cityName);

        <span class="hljs-keyword">return</span> cityName;

        <span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">GenerateName</span>()</span> => GenerateString(<span class="hljs-number">65</span>, <span class="hljs-number">90</span>, <span class="hljs-number">3</span>);
    }
}
</code></pre>
<p>Now there is only one step remaining - register customizations:</p>
<pre><code class="hljs language-csharp"><span class="hljs-keyword">var</span> rand = <span class="hljs-keyword">new</span> Random();
<span class="hljs-keyword">var</span> fixture = <span class="hljs-keyword">new</span> Fixture();
fixture.Customizations.Add(<span class="hljs-keyword">new</span> ElementDepartureCustomization(rand));
fixture.Customizations.Add(<span class="hljs-keyword">new</span> ElementPriceCustomization(request.DeparturesAmount, rand));

<span class="hljs-keyword">var</span> tirps = fixture.CreateMany&#x3C;TripDto>(<span class="hljs-number">5</span>);
</code></pre>
<h2>References</h2>
<ul>
  <li><a href="https://timdeschryver.dev/blog/why-i-stopped-worrying-about-test-setups-by-using-autofixture#composite-customizations">Why I stopped worrying about test setups by using AutoFixture</a></li>
  <li><a href="https://adamstorr.azurewebsites.net/blog/autofixture-generate-specific-format-with-specimen-builders">https://adamstorr.azurewebsites.net/blog/autofixture-generate-specific-format-with-specimen-builders</a></li>
  <li><a href="http://www.longest.io/2015/03/07/intro-to-specimen-builders-in-autofixture.html">http://www.longest.io/2015/03/07/intro-to-specimen-builders-in-autofixture.html</a></li>
</ul>
</article></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"noteKey":["csharp","csharp-testing-with-autofixture"],"note":{"title":"AutoFixture In C#","date":"2022-04-10","content":"\n\u003ch2\u003eData Customization\u003c/h2\u003e\n\u003cp\u003eWe have a simple model for test:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-csharp\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003erecord\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eTripDto\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eGuid Id, IEnumerable\u0026#x3C;CityDto\u003e City, \u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e Price, \u003cspan class=\"hljs-built_in\"\u003eint\u003c/span\u003e Days\u003c/span\u003e)\u003c/span\u003e { }\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003erecord\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eCityDto\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e Name, \u003cspan class=\"hljs-built_in\"\u003eint\u003c/span\u003e Size\u003c/span\u003e)\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNow let's introduce some constraints.\u003c/p\u003e\n\u003cp\u003e\n  We want to have trips with amount of cities between \u003ccode\u003e1\u003c/code\u003e and \u003ccode\u003e5\u003c/code\u003e, prices between \u003ccode\u003e\"5000.5\"\u003c/code\u003e and \u003ccode\u003e\"9000.5\"\u003c/code\u003e,\n  duration between \u003ccode\u003e3\u003c/code\u003e and \u003ccode\u003e6\u003c/code\u003e days.\n\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eCity.Name\u003c/code\u003e must consist of only three capital letters\u003c/p\u003e\n\u003cp\u003eAnd say, we would have a \u003ccode\u003ePrice\u003c/code\u003e as a string to be able to mitigate precision problems on serialization.\u003c/p\u003e\n\u003cp\u003e\n  To create customized objects with \u003ccode\u003eAutofixture\u003c/code\u003e we need to create an class, which implements\n  \u003ccode\u003eISpecimenBuilder\u003c/code\u003e interface. This class will be executed every time auto-fixture will\n  need to create new instance of \u003ccode\u003eEntity\u003c/code\u003e.\n\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-csharp\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eEntityCustomization\u003c/span\u003e : \u003cspan class=\"hljs-title\"\u003eISpecimenBuilder\u003c/span\u003e\n{\n    \u003cspan class=\"hljs-keyword\"\u003eprotected\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ereadonly\u003c/span\u003e Random Rand;\n\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003eprotected\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eAbstractCustomization\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eRandom rand\u003c/span\u003e)\u003c/span\u003e\n    {\n        Rand = rand;\n    }\n\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eobject\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eCreate\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-built_in\"\u003eobject\u003c/span\u003e request, ISpecimenContext context\u003c/span\u003e)\u003c/span\u003e\n    {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (request \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enot\u003c/span\u003e Type type || type != \u003cspan class=\"hljs-keyword\"\u003etypeof\u003c/span\u003e(Entity))\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e NoSpecimen(); \u003cspan class=\"hljs-comment\"\u003e// if a request, sent to our customization is not of type\u003c/span\u003e\n            \u003cspan class=\"hljs-comment\"\u003e// we need to create, return signal, that we don't need to customize on it\u003c/span\u003e\n\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Entity(); \u003cspan class=\"hljs-comment\"\u003e// if current request is of type Entity, we can return customized instance of it\u003c/span\u003e\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\n  Partially this request type check will be on each custom \u003ccode\u003eSpecimenBuilder\u003c/code\u003e. To make some\n  generalization, let's create a base abstract class, which will accumulate some common behavior\n  and add additional randomization logic:\n\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-csharp\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eabstract\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eAbstractCustomization\u003c/span\u003e\u0026#x3C;\u003cspan class=\"hljs-title\"\u003eT\u003c/span\u003e\u003e : \u003cspan class=\"hljs-title\"\u003eISpecimenBuilder\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ewhere\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eT\u003c/span\u003e : \u003cspan class=\"hljs-title\"\u003enotnull\u003c/span\u003e\n{\n    \u003cspan class=\"hljs-keyword\"\u003eprotected\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ereadonly\u003c/span\u003e Random Rand;\n\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003eprotected\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eAbstractCustomization\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eRandom rand\u003c/span\u003e)\u003c/span\u003e\n    {\n        Rand = rand;\n    }\n\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eobject\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eCreate\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-built_in\"\u003eobject\u003c/span\u003e request, ISpecimenContext context\u003c/span\u003e)\u003c/span\u003e\n    {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (request \u003cspan class=\"hljs-keyword\"\u003eis\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enot\u003c/span\u003e Type type || type != \u003cspan class=\"hljs-keyword\"\u003etypeof\u003c/span\u003e(T))\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e NoSpecimen();\n\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e Create(context);\n    }\n\n    \u003cspan class=\"hljs-comment\"\u003e// this method will be executed only in case, when request is required type\u003c/span\u003e\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eabstract\u003c/span\u003e T \u003cspan class=\"hljs-title\"\u003eCreate\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eISpecimenContext context\u003c/span\u003e)\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-comment\"\u003e// returns string with numeric content\u003c/span\u003e\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003eprotected\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eGetRandomNumberString\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-built_in\"\u003edouble\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e, \u003cspan class=\"hljs-built_in\"\u003edouble\u003c/span\u003e to\u003c/span\u003e)\u003c/span\u003e =\u003e Convert.ToString(\n        Rand.NextInt64((\u003cspan class=\"hljs-built_in\"\u003elong\u003c/span\u003e)\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e, (\u003cspan class=\"hljs-built_in\"\u003elong\u003c/span\u003e)(to - \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)) + Rand.NextDouble());\n\n    \u003cspan class=\"hljs-comment\"\u003e// get ASCII char by it's index\u003c/span\u003e\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003eprotected\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003echar\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eGetRandomASCIIChar\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-built_in\"\u003eint\u003c/span\u003e fromIndex, \u003cspan class=\"hljs-built_in\"\u003eint\u003c/span\u003e toIndex\u003c/span\u003e)\u003c/span\u003e =\u003e (\u003cspan class=\"hljs-built_in\"\u003echar\u003c/span\u003e)Rand.Next(fromIndex, toIndex);\n\n    \u003cspan class=\"hljs-comment\"\u003e// get random int in given range\u003c/span\u003e\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003eprotected\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eint\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eGetInt\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-built_in\"\u003eint\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e, \u003cspan class=\"hljs-built_in\"\u003eint\u003c/span\u003e to\u003c/span\u003e)\u003c/span\u003e =\u003e Rand.Next(\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e, to);\n\n    \u003cspan class=\"hljs-comment\"\u003e// get string of given length from characters between specified indexes\u003c/span\u003e\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003eprotected\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eGenerateString\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-built_in\"\u003eint\u003c/span\u003e asciiIndexFrom, \u003cspan class=\"hljs-built_in\"\u003eint\u003c/span\u003e asciiIndexTo, \u003cspan class=\"hljs-built_in\"\u003eint\u003c/span\u003e length\u003c/span\u003e)\u003c/span\u003e =\u003e Enumerable\n        .Repeat(() =\u003e GetRandomASCIIChar(asciiIndexFrom, asciiIndexTo), length)\n        .Aggregate(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e StringBuilder(), (acc, getChar) =\u003e\n        {\n            acc.Append(getChar());\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e acc;\n        })\n        .ToString();\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNow create a concrete implementations for two our DTOs:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-csharp\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eTripCustomizations\u003c/span\u003e : \u003cspan class=\"hljs-title\"\u003eAbstractCustomization\u003c/span\u003e\u0026#x3C;\u003cspan class=\"hljs-title\"\u003eTripDto\u003c/span\u003e\u003e\n{\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eTripCustomizations\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eRandom rand\u003c/span\u003e) : \u003cspan class=\"hljs-title\"\u003ebase\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003erand\u003c/span\u003e)\u003c/span\u003e { }\n\n    \u003cspan class=\"hljs-comment\"\u003e// generate TripDto object which satisfies required boundaries:\u003c/span\u003e\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eoverride\u003c/span\u003e TripDto \u003cspan class=\"hljs-title\"\u003eCreate\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eISpecimenContext context\u003c/span\u003e)\u003c/span\u003e =\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e(\n        Id: Guid.NewGuid(),\n        \u003cspan class=\"hljs-comment\"\u003e// create collection of cities with length between 1 and 5\u003c/span\u003e\n        Cities: context.CreateMany\u0026#x3C;CityDto\u003e(GetInt(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e)),\n        \u003cspan class=\"hljs-comment\"\u003e// using methods, defined in abstract class to generate some randomized values\u003c/span\u003e\n        Price: GetRandomNumberString(\u003cspan class=\"hljs-number\"\u003e5000.5\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e9000.5\u003c/span\u003e),\n        Days: GetInt(\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e)\n    );\n}\n\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eCityCustomization\u003c/span\u003e : \u003cspan class=\"hljs-title\"\u003eAbstractCustomization\u003c/span\u003e\u0026#x3C;\u003cspan class=\"hljs-title\"\u003eCityDto\u003c/span\u003e\u003e\n{\n    \u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ereadonly\u003c/span\u003e HashSet\u0026#x3C;\u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e\u003e _usedCityNames = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e();\n\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eCityCustomization\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eRandom rand\u003c/span\u003e) : \u003cspan class=\"hljs-title\"\u003ebase\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003erand\u003c/span\u003e)\u003c/span\u003e\n    {\n    }\n\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eoverride\u003c/span\u003e CityDto \u003cspan class=\"hljs-title\"\u003eCreate\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eISpecimenContext context\u003c/span\u003e)\u003c/span\u003e =\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e(\n        \u003cspan class=\"hljs-comment\"\u003e// on city name we have a constraint - it has to be unique and consist of 3 capital latin letters.\u003c/span\u003e\n        Name: GetUnique3CapitalCharCityName(),\n        Size: GetInt(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e)\n    );\n\n    \u003cspan class=\"hljs-comment\"\u003e// to create every time only unique names, we will use hash set, stored as object's private member\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// every time we will need to get new name we will check if it exists in this cash and generate new\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// until we won't have a unique one. having unique name we will add it to cash and then return.\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// there may be more efficient implementation, e.g. using tries, but it is enough for now =)\u003c/span\u003e\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eGetUnique3CapitalCharCityName\u003c/span\u003e()\u003c/span\u003e\n    {\n        \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e cityName = GenerateName();\n        \u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e (_usedCityNames.Contains(cityName))\n        {\n            cityName = GenerateName();\n        }\n        _usedCityNames.Add(cityName);\n\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e cityName;\n\n        \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eGenerateName\u003c/span\u003e()\u003c/span\u003e =\u003e GenerateString(\u003cspan class=\"hljs-number\"\u003e65\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e90\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e);\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNow there is only one step remaining - register customizations:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-csharp\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e rand = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Random();\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e fixture = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e Fixture();\nfixture.Customizations.Add(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e ElementDepartureCustomization(rand));\nfixture.Customizations.Add(\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e ElementPriceCustomization(request.DeparturesAmount, rand));\n\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e tirps = fixture.CreateMany\u0026#x3C;TripDto\u003e(\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eReferences\u003c/h2\u003e\n\u003cul\u003e\n  \u003cli\u003e\u003ca href=\"https://timdeschryver.dev/blog/why-i-stopped-worrying-about-test-setups-by-using-autofixture#composite-customizations\"\u003eWhy I stopped worrying about test setups by using AutoFixture\u003c/a\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ca href=\"https://adamstorr.azurewebsites.net/blog/autofixture-generate-specific-format-with-specimen-builders\"\u003ehttps://adamstorr.azurewebsites.net/blog/autofixture-generate-specific-format-with-specimen-builders\u003c/a\u003e\u003c/li\u003e\n  \u003cli\u003e\u003ca href=\"http://www.longest.io/2015/03/07/intro-to-specimen-builders-in-autofixture.html\"\u003ehttp://www.longest.io/2015/03/07/intro-to-specimen-builders-in-autofixture.html\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n"}},"__N_SSG":true},"page":"/notes/[...noteKey]","query":{"noteKey":["csharp","csharp-testing-with-autofixture"]},"buildId":"6ijx-V4F20HyUkW-8GqL_","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>